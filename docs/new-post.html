
<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" href="../main.css">
	<title>itanglo | Exploring the craft of web development</title>
</head>
<body>
	<h1><a href="/">itanglo</a></h1>
	<p>Exploring the craft of web development</p>

<form id="newPostForm">
	<input type="text" id="postTitle" name="title" class="itanglo-textInput">
	<textarea name="postBody" id="postBody" cols="30" rows="10" class="itanglo-textInput itanglo-textArea"></textarea>
	<button type="submit" id="submitBtn" class="itanglo-submitBtn"><span>Post</span></button>
</form>

<p id="pageStatus"></p>

<script>
	const titleInput = document.getElementById('postTitle');
	const bodyInput = document.getElementById('postBody');
	const submitBtn = document.getElementById('submitBtn');
	const form = document.getElementById('newPostForm');
	const pageStatus = document.getElementById('pageStatus');
	const hideClass = 'hide';
	const statusMessages = {
		loading: 'Loading...',
		success: 'That went well ðŸ¤“',
		error: 'Hmmm, something seems to have gone wrong ðŸ¤¨'
	};
	
	form.addEventListener('submit', (e) => {
		e.preventDefault();

		const h3RegEx = /###\s*(.+)/g;
		const body = bodyInput.value.replace(h3RegEx, '<h3>$1</h3>');

		fetch('/post', {
			method: 'POST',
			body: JSON.stringify({
				title: titleInput.value,
				body
			})
		}).then(response => {
			pageStatus.innerHTML = statusMessages.loading;

			if (response.status === 200) {
				// handle success
				pageStatus.innerHTML = statusMessages.success;
				titleInput.value = '';
				bodyInput.value = '';
			}
			else {
				// handle error
				pageStatus.innerHTML = statusMessages.error;
			}
		});
	});
</script>

</body>
</html>